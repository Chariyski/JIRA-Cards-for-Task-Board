<link rel="import" href="../../../bower_components/polymer/polymer.html"/>
<link rel="import" href="../../../bower_components/iron-ajax/iron-ajax.html">

<dom-module id="jira-fix-version-helper">
    <style>
        select {
            width: 150px
        }
    </style>
    <template>
        <select id="JIRA-projects" class="flex-2" on-change="_getVersions">
            <template is="dom-repeat" items="{{projects}}">
                <option value="{{item.key}}">{{item.name}}</option>
            </template>
        </select>

        <select id="JIRA-project-versions" class="flex-2">
            <template is="dom-repeat" items="{{versions}}">
                <option value="{{item.id}}">{{item.name}}</option>
            </template>
        </select>

        <!-- AJAX for TODO-->
        <iron-ajax
            id="ajax-for-projects"
            content-type="application/json"
            handle-as="json"
            last-response="{{projects}}"></iron-ajax>
        <!-- AJAX for TODO-->

        <!-- AJAX for TODO-->
        <iron-ajax
            id="ajax-for-versions"
            content-type="application/json"
            handle-as="json"
            last-response="{{versions}}"></iron-ajax>
        <!-- AJAX for TODO-->
    </template>
</dom-module>

<script>
    (function () {
        'use strict';

        Polymer({
            is: 'jira-fix-version-helper',
            properties: {
                jiraUrlAddress: {
                    type: String,
                    notify: true,
                    observer: '_jiraUrlAddressChanged'
                }
            },
            _jiraUrlAddressChanged: function (newValue, oldValue) {
                let ajaxForProjects = this.$['ajax-for-projects'];

                ajaxForProjects.url = this.jiraUrlAddress + '/rest/api/2/project/';
                ajaxForProjects.generateRequest();
            },

            _getVersions: function () {
                let ajaxForVersions = this.$['ajax-for-versions'];

                ajaxForVersions.url = this.jiraUrlAddress + '/rest/api/2/project/' + this.$['JIRA-projects'].value + '/versions';
                ajaxForVersions.generateRequest();
            }
        });
    })();
</script>
